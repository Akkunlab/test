<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <title>Prototype</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        fontFamily: {
          sans: ['"SF Pro Text"', 'ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Hiragino Kaku Gothic ProN', 'Meiryo', 'sans-serif']
        }
      }
    }
  </script>
  <style>
    :root { 
      --keyboard-height: 300px;
      --neumorphism-bg: #e6e7ee;
      --neumorphism-light: #ffffff;
      --neumorphism-dark: #d1d9e6;
      --neumorphism-shadow-light: rgba(255, 255, 255, 0.7);
      --neumorphism-shadow-dark: rgba(174, 174, 192, 0.4);
    }
    .key {
      background: var(--neumorphism-bg);
      box-shadow: inset 12px 12px 24px var(--neumorphism-shadow-dark),
                  inset -12px -12px 24px var(--neumorphism-shadow-light);
      border: none; color: #5a5a6b; font-weight: 500; transition: all 0.15s ease;
      border-radius: 50% !important; aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
    }
    .key:active { 
      background: #5a5a6b; color: var(--neumorphism-bg);
      box-shadow: 4px 4px 8px var(--neumorphism-shadow-dark),
                  -4px -4px 8px var(--neumorphism-shadow-light);
    }
    .key:hover {
      box-shadow: inset 8px 8px 16px var(--neumorphism-shadow-dark),
                  inset -8px -8px 16px var(--neumorphism-shadow-light);
    }
    .key.tall-key { border-radius: 32px !important; aspect-ratio: auto; }
    .content-with-keyboard { padding-bottom: calc(var(--keyboard-height) + env(safe-area-inset-bottom)); }
    .keyboard-fixed {
      position: fixed; left: 0; right: 0; bottom: env(safe-area-inset-bottom);
      background: var(--neumorphism-bg);
      max-height: 48vh; overflow: auto;
      box-shadow: 0 -8px 25px rgba(174, 174, 192, 0.3), 0 -4px 15px rgba(255, 255, 255, 0.5);
      z-index: 60;
    }
    .keyboard-fixed .mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }
    @media (max-width:420px) { .keyboard-fixed .grid > button, .keyboard-fixed .grid > div { min-width: 52px; } }
    .home-indicator { height: 6px; width: 140px; max-width: 34vw; background: var(--neumorphism-bg);
      border-radius: 999px;
      box-shadow: inset 6px 6px 12px var(--neumorphism-shadow-dark),
                  inset -6px -6px 12px var(--neumorphism-shadow-light);
    }
    .bottom-icon { 
      width: 48px; height: 48px; background: var(--neumorphism-bg);
      box-shadow: inset 8px 8px 16px var(--neumorphism-shadow-dark),
                  inset -8px -8px 16px var(--neumorphism-shadow-light);
      color: #5a5a6b; transition: all 0.15s ease; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
    }
    .bottom-icon:active {
      background: #5a5a6b; color: var(--neumorphism-bg);
      box-shadow: 4px 4px 8px var(--neumorphism-shadow-dark),
                  -4px -4px 8px var(--neumorphism-shadow-light);
    }
    .bottom-icon:hover {
      box-shadow: inset 6px 6px 12px var(--neumorphism-shadow-dark),
                  inset -6px -6px 12px var(--neumorphism-shadow-light);
    }
    .content-area {
      background: var(--neumorphism-bg);
      border-radius: 20px;
      border: 1px solid rgba(174, 174, 192, 0.2);
    }
    #editor {
      -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text;
      caret-color: #5a5a6b; color: #5a5a6b; background: transparent;
      white-space: pre-wrap; word-wrap: break-word; position: relative;
    }
    .pseudo-cursor { display: inline-block; width: 2px; height: 1.2em; background-color: #5a5a6b; animation: cursor-blink 1s infinite; vertical-align: text-bottom; margin: 0 1px; }
    @keyframes cursor-blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
    .flick-popup {
      position: absolute; background: var(--neumorphism-bg); border-radius: 20px;
      box-shadow: 8px 8px 16px var(--neumorphism-shadow-dark),
                  -8px -8px 16px var(--neumorphism-shadow-light);
      padding: 16px; font-size: 18px; color: #5a5a6b; font-weight: 600; z-index: 1000; pointer-events: none;
      transform: translate(-50%, -120%); opacity: 0; transition: opacity 0.15s ease; min-width: 140px; text-align: center;
    }
    .flick-popup.show { opacity: 1; }
    .flick-layout { display: grid; grid-template-areas: ". up ." "left center right" ". down ."; gap: 12px; align-items: center; justify-items: center; }
    .flick-char { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.15s ease;
      background: var(--neumorphism-bg);
      box-shadow: inset 4px 4px 8px var(--neumorphism-shadow-dark),
                  inset -4px -4px 16px var(--neumorphism-shadow-light);
      font-size: 16px; font-weight: 600; }
    .flick-char.center { grid-area: center; width: 44px; height: 44px; background: var(--neumorphism-bg);
      box-shadow: inset 6px 6px 12px var(--neumorphism-shadow-dark),
                  inset -6px -6px 12px var(--neumorphism-shadow-light);
      font-size: 20px; font-weight: 700; }
    .flick-char.up { grid-area: up; } .flick-char.left { grid-area: left; } .flick-char.right { grid-area: right; } .flick-char.down { grid-area: down; }
    .flick-char.active { background: #5a5a6b; color: var(--neumorphism-bg); transform: scale(1.15);
      box-shadow: 4px 4px 8px var(--neumorphism-shadow-dark),
                  -4px -4px 8px var(--neumorphism-shadow-light); }
    input[readonly], textarea[readonly] { pointer-events: none; }
    @media (max-width: 768px) {
      #editor { -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
    }
  </style>
</head>
<body class="min-h-screen" style="background: #e6e7ee;">

  <div class="iphone relative min-h-screen w-full overflow-auto" style="background: #e6e7ee;">

    <!-- Content area -->
    <div class="px-5">
      <div class="mt-0 h-[540px] w-full content-area">
        <div class="p-6 text-[24px] leading-8 tracking-wide">
          <div id="editor" contenteditable="true" class="min-h-[28px] outline-none break-words">„Åì„Çì„Å´„Å°„ÅØ</div>
        </div>
      </div>
    </div>

    <!-- Kana keyboard -->
    <div id="keyboard" class="keyboard-fixed pt-3 pb-4">
      <div class="mx-3 grid grid-cols-[70px_repeat(3,minmax(0,1fr))_70px] gap-3">

        <!-- left column -->
        <button class="h-16 w-16 key text-4xl">‚Üí</button>

         <!-- row 1 -->
        <button class="h-16 w-16 key text-4xl" data-kana="„ÅÇ,„ÅÑ,„ÅÜ,„Åà,„Åä">„ÅÇ</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Åã,„Åç,„Åè,„Åë,„Åì">„Åã</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Åï,„Åó,„Åô,„Åõ,„Åù">„Åï</button>
        <button data-action="backspace" class="h-16 w-16 key text-4xl">‚å´</button>

         <!-- left column row2 -->
        <button class="h-16 w-16 key text-4xl" data-action="toggle">‚Ü∫</button>

         <!-- row 2 -->
        <button class="h-16 w-16 key text-4xl" data-kana="„Åü,„Å°,„Å§,„Å¶,„Å®">„Åü</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Å™,„Å´,„Å¨,„Å≠,„ÅÆ">„Å™</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„ÅØ,„Å≤,„Åµ,„Å∏,„Åª">„ÅØ</button>
        <button class="h-16 w-16 key text-3xl leading-tight" data-action="space">Á©∫ÁôΩ</button>
         <!-- left column row3 -->
        <button class="h-16 w-16 key text-3xl" data-action="mode">ABC</button>

        <!-- row 3 -->
        <button class="h-16 w-16 key text-4xl" data-kana="„Åæ,„Åø,„ÇÄ,„ÇÅ,„ÇÇ">„Åæ</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„ÇÑ,„ÇÜ,„Çà">„ÇÑ</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Çâ,„Çä,„Çã,„Çå,„Çç">„Çâ</button>
        <button class="row-span-2 h-[140px] w-16 key tall-key text-4xl" data-action="enter">ÊîπË°å</button>

         <!-- left column row4 -->
        <button class="h-16 w-16 key text-4xl" data-action="emoji">üòä</button>

        <!-- row 4 -->
        <button class="h-16 w-16 key text-2xl" data-kana="^_^">^_^</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Çè,„Çí,„Çì">„Çè</button>
        <button class="h-16 w-16 key text-xl" data-action="punct">„ÄÅÔºüÔºÅ</button>
      </div>

      <!-- bottom controls -->
      <div class="mx-2 mt-2">
        <div class="flex items-center justify-between px-2">
          <button aria-label="language" class="rounded-full grid place-items-center text-xl bottom-icon" style="padding:6px">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15 15 0 0 1 0 20"/></svg>
          </button>

          <button aria-label="mic" class="rounded-full grid place-items-center text-xl bottom-icon" style="padding:6px">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v11"/><path d="M19 11a7 7 0 0 1-14 0"/><path d="M12 21v2"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- üêû Debug dockÔºàÂàùÊúü„ÅØÈñâ„Åò„Å¶„ÅÑ„ÇãÔºâ -->
  <div id="debugDock" class="fixed z-[70] right-3" style="bottom: calc(var(--keyboard-height) + 8px);">
    <div class="flex justify-end">
      <button id="btnDebugToggle" class="rounded-full px-3 py-2 text-sm shadow bg-white/80 backdrop-blur hover:bg-white border border-gray-300 flex items-center gap-1">
        üêû <span class="hidden sm:inline">Debug</span>
      </button>
    </div>
    <div id="debugPanel" class="hidden mt-2 w-[min(92vw,680px)] max-h-[50vh] overflow-hidden rounded-xl border border-gray-300 bg-white/90 backdrop-blur shadow-lg">
      <div class="flex items-center gap-2 p-2 border-b bg-gray-50">
        <button id="btnConnect"    class="px-3 py-1.5 rounded border bg-white hover:bg-gray-100">üîó Connect</button>
        <button id="btnDisconnect" class="px-3 py-1.5 rounded border bg-white hover:bg-gray-100" disabled>üîå Disconnect</button>
        <button id="btnClearLog"   class="ml-auto px-3 py-1.5 rounded border bg-white hover:bg-gray-100">‚úñ Èñâ„Åò„Çã</button>
      </div>
      <pre id="log" class="p-2 text-xs leading-5 h-[38vh] overflow-auto whitespace-pre-wrap"></pre>
      <div class="p-2 text-xs text-gray-600 border-t">State: <span id="bleState">Idle</span></div>
    </div>
  </div>

  <script>
    // ====== Web Bluetooth (NUS) ======
    const SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
    const RX_UUID      = '6e400002-b5a3-f393-e0a9-e50e24dcca9e'; // write*/M5„Å∏
    const TX_UUID      = '6e400003-b5a3-f393-e0a9-e50e24dcca9e'; // notify/M5‚ÜíWeb

    let device=null, server=null, service=null, rxChar=null, txChar=null;
    let lastSendAt = 0;             // ÈÄÅ‰ø°„Éá„Éê„Ç¶„É≥„ÇπÁî®
    const SEND_DEBOUNCE_MS = 40;    // ÊúÄÁü≠40msÈñìÈöî

    // Debug UI
    const $ = (id)=>document.getElementById(id);
    const logEl = $('log');
    function log(...args){
      const ts = new Date().toLocaleTimeString();
      const line = `[${ts}] ${args.join(' ')}`;
      logEl.textContent += line + '\n';
      logEl.scrollTop = logEl.scrollHeight;
      console.log(...args);
    }
    function setState(s){ $('bleState').textContent = s; }
    (function setupDebug(){
      const panel = $('debugPanel');
      $('btnDebugToggle').onclick = ()=> panel.classList.toggle('hidden');
      // „Äå‚úñ Èñâ„Åò„Çã„Äç„Éú„Çø„É≥„Åß„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
      const closeBtn = $('btnClearLog');
      if (closeBtn) closeBtn.onclick = ()=> panel.classList.add('hidden');
    })();

    // Êõ∏„ÅçËæº„ÅøÊñπÂºè„ÇíËá™ÂãïÈÅ∏Êäû
    async function writeAuto(characteristic, bytes, label=''){
      const p = characteristic.properties || {};
      try {
        if (p.writeWithoutResponse && characteristic.writeValueWithoutResponse) {
          await characteristic.writeValueWithoutResponse(bytes);
          log('‚û°Ô∏è (wnr)', label);
          return true;
        }
      } catch(e){ log('‚ö†Ô∏è wnr failed:', e.message || e); }
      try {
        if (p.write && characteristic.writeValue) {
          await characteristic.writeValue(bytes);
          log('‚û°Ô∏è (ack)', label);
          return true;
        }
      } catch(e){ log('‚ö†Ô∏è write failed:', e.message || e); }
      log('‚ùå No supported write method');
      return false;
    }

    async function connectBLE(){
      try{
        device = await navigator.bluetooth.requestDevice({
          filters: [{ services: [SERVICE_UUID] }],
          optionalServices: [SERVICE_UUID]
        });
        device.addEventListener('gattserverdisconnected', onDisconnected);

        server  = await device.gatt.connect();
        service = await server.getPrimaryService(SERVICE_UUID);
        rxChar  = await service.getCharacteristic(RX_UUID);
        log('RX props:', JSON.stringify({
          write: !!rxChar.properties.write,
          wnr: !!rxChar.properties.writeWithoutResponse
        }));

        try {
          txChar  = await service.getCharacteristic(TX_UUID);
          await txChar.startNotifications();
          txChar.addEventListener('characteristicvaluechanged',(e)=>{
            const v = new TextDecoder().decode(e.target.value);
            log('üîî', v);
          });
          log('TX notify: started');
        } catch(e){ log('‚ÑπÔ∏è no TX notify:', e.message || e); }

        $('btnDisconnect').disabled = false;
        setState('Connected to ' + (device.name || '(no name)'));
        log('‚úÖ Connected to', device.name || '(no name)');

        // ÁñéÈÄöÁ¢∫Ë™ç
        await writeAuto(rxChar, new TextEncoder().encode('PING'), 'PING');
      }catch(e){
        log('‚ùå', e.message || e);
        setState('Error / Not connected');
      }
    }
    function onDisconnected(){
      $('btnDisconnect').disabled = true;
      setState('Disconnected');
      log('üíî Disconnected');
      rxChar = null; txChar = null; service = null; server = null; device = null;
    }
    function disconnectBLE(){
      try{
        if(device?.gatt?.connected){ device.gatt.disconnect(); }
      }catch(e){ log('‚ö†Ô∏è disconnect error:', e.message || e); }
    }
    $('btnConnect').onclick = connectBLE;
    $('btnDisconnect').onclick = disconnectBLE;

    // „Ç≠„ÉºÊäº‰∏ã„Åß„ÄåON„ÄçÈÄÅ‰ø°Ôºà„Éá„Éê„Ç¶„É≥„Çπ‰ªò„ÅçÔºâ
    async function triggerHaptic(){
      const now = performance.now();
      if (now - lastSendAt < SEND_DEBOUNCE_MS) return;
      lastSendAt = now;

      if (!rxChar) {
        if (navigator.vibrate) navigator.vibrate(10); // Êú™Êé•Á∂öÊôÇ„ÅÆÁ∞°Êòì„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
        log('‚ö†Ô∏è Not connected; local vibrate fallback');
        return;
      }
      await writeAuto(rxChar, new TextEncoder().encode('ON'), 'ON');
    }
  </script>

  <script>
    // ====== „Ç≠„Éº„Éú„Éº„ÉâÂà∂Âæ° + ÊåØÂãï„Éà„É™„Ç¨„Éº ======
    (function(){
      const editor = document.getElementById('editor');
      if(!editor) return;
      editor.setAttribute('role','textbox');

      // „É¢„Éê„Ç§„É´„Ç≠„Éº„Éú„Éº„ÉâÊäëÊ≠¢
      editor.setAttribute('readonly', 'readonly');
      editor.setAttribute('inputmode', 'none');
      editor.style.caretColor = 'transparent';

      editor.addEventListener('click', ()=> {
        editor.removeAttribute('readonly');
        editor.focus();
        setTimeout(() => {
          editor.setAttribute('readonly', 'readonly');
          updateDisplay();
        }, 10);
      });
      editor.addEventListener('keydown', (e) => { e.preventDefault(); return false; });
      editor.addEventListener('input',  (e) => { e.preventDefault(); return false; });

      const keys = Array.from(document.querySelectorAll('.key'));

      // Áñë‰ºº„Ç´„Éº„ÇΩ„É´ÁÆ°ÁêÜ
      let cursorPosition = 0;
      let flickPopup = null;

      function createFlickPopup() {
        if (flickPopup) return flickPopup;
        flickPopup = document.createElement('div');
        flickPopup.className = 'flick-popup';
        document.body.appendChild(flickPopup);
        return flickPopup;
      }
      function showFlickUI(button, kanaString) {
        if (!kanaString) return;
        const popup = createFlickPopup();
        const kanaChars = kanaString.split(',').map(s => s.trim());
        popup.innerHTML = `
          <div class="flick-layout">
            <div class="flick-char up">${kanaChars[1] || ''}</div>
            <div class="flick-char left">${kanaChars[4] || ''}</div>
            <div class="flick-char center">${kanaChars[0] || ''}</div>
            <div class="flick-char right">${kanaChars[2] || ''}</div>
            <div class="flick-char down">${kanaChars[3] || ''}</div>
          </div>`;
        const rect = button.getBoundingClientRect();
        popup.style.left = rect.left + rect.width / 2 + 'px';
        popup.style.top  = rect.top + 'px';
        popup.classList.add('show');
      }
      function hideFlickUI() {
        if (flickPopup) {
          flickPopup.classList.remove('show');
          flickPopup.querySelectorAll('.flick-char').forEach(char => char.classList.remove('active'));
        }
      }
      function updateFlickDirection(dx, dy, threshold = 20) {
        if (!flickPopup) return;
        const chars = flickPopup.querySelectorAll('.flick-char');
        chars.forEach(char => char.classList.remove('active'));
        const adx = Math.abs(dx), ady = Math.abs(dy);
        if (Math.max(adx, ady) >= threshold) {
          if (adx > ady) (dx > 0 ? flickPopup.querySelector('.flick-char.right') : flickPopup.querySelector('.flick-char.left'))?.classList.add('active');
          else           (dy < 0 ? flickPopup.querySelector('.flick-char.up')    : flickPopup.querySelector('.flick-char.down'))?.classList.add('active');
        } else {
          flickPopup.querySelector('.flick-char.center')?.classList.add('active');
        }
      }
      function updateDisplay() {
        const text = editor.textContent || '';
        const beforeCursor = text.substring(0, cursorPosition);
        const afterCursor = text.substring(cursorPosition);
        editor.innerHTML = '';
        if (beforeCursor) {
          const beforeSpan = document.createElement('span');
          beforeSpan.textContent = beforeCursor;
          editor.appendChild(beforeSpan);
        }
        const cursor = document.createElement('span');
        cursor.className = 'pseudo-cursor';
        editor.appendChild(cursor);
        if (afterCursor) {
          const afterSpan = document.createElement('span');
          afterSpan.textContent = afterCursor;
          editor.appendChild(afterSpan);
        }
        if (!text) editor.appendChild(cursor);
      }
      function appendText(t){
        const currentText = editor.textContent || '';
        const newText = currentText.substring(0, cursorPosition) + t + currentText.substring(cursorPosition);
        editor.textContent = newText;
        cursorPosition += t.length;
        updateDisplay();
      }
      function backspace(){
        if (cursorPosition > 0) {
          const currentText = editor.textContent || '';
          const newText = currentText.substring(0, cursorPosition - 1) + currentText.substring(cursorPosition);
          editor.textContent = newText;
          cursorPosition--;
          updateDisplay();
        }
      }
      function insertLineBreak(){ appendText('\n'); }

      // Pointer-based flick detection + HAPTIC TRIGGER
      keys.forEach(k => {
        let start = null;
        k.style.touchAction = 'none';

        k.addEventListener('pointerdown', e => {
          k.setPointerCapture(e.pointerId);
          start = {x: e.clientX, y: e.clientY};
          const kana = k.dataset.kana;
          if (kana) showFlickUI(k, kana);
        });

        k.addEventListener('pointermove', e => {
          if (!start) return;
          const dx = e.clientX - start.x;
          const dy = e.clientY - start.y;
          const kana = k.dataset.kana;
          if (kana) updateFlickDirection(dx, dy);
        });

        k.addEventListener('pointerup', async e => {
          if(!start) return;

          hideFlickUI();

          const dx = e.clientX - start.x;
          const dy = e.clientY - start.y;
          const adx = Math.abs(dx), ady = Math.abs(dy);
          const threshold = 20; // px
          const kana = k.dataset.kana;
          const action = k.dataset.action;

          let didInput = false;

          if(action){
            switch(action){
              case 'backspace': backspace(); didInput = true; break;
              case 'space': appendText(' '); didInput = true; break;
              case 'enter': insertLineBreak(); didInput = true; break;
              case 'emoji': appendText('üòä'); didInput = true; break;
              case 'punct': appendText('„ÄÅ'); didInput = true; break;
              default: break;
            }
            start = null;
            if (didInput) { await triggerHaptic(); }
            return;
          }

          if(kana){
            const parts = kana.split(',').map(s=>s.trim()).filter(Boolean);
            let idx = 0; // tap
            if(Math.max(adx, ady) >= threshold){
              if(adx > ady) idx = dx > 0 ? 2 : 4; // right : left
              else          idx = dy < 0 ? 1 : 3; // up : down
            }
            if(idx >= parts.length) idx = Math.min(parts.length-1, idx);
            const char = parts[idx] || parts[0];
            appendText(char);
            didInput = true;
          } else {
            const text = k.textContent.trim();
            if(text){ appendText(text); didInput = true; }
          }
          start = null;
          if (didInput) { await triggerHaptic(); }
        });

        k.addEventListener('pointercancel', () => {
          start = null;
          hideFlickUI();
        });
      });

      // ÂàùÊúüÂåñ
      const initialText = editor.textContent || '„Åì„Çì„Å´„Å°„ÅØ';
      editor.textContent = initialText;
      cursorPosition = initialText.length;
      updateDisplay();
      createFlickPopup();

      editor.removeAttribute('readonly');
      setTimeout(() => { editor.setAttribute('readonly', 'readonly'); }, 50);
    })();
  </script>

  <script>
    // ====== „É¨„Ç§„Ç¢„Ç¶„ÉàË™øÊï¥Ôºö„Ç≠„Éº„Éú„Éº„ÉâÈ´ò„Åï„Çí CSS Â§âÊï∞„Å∏ ======
    (function(){
      const kb = document.getElementById('keyboard');
      const content = document.querySelector('.px-5');
      if(!kb || !content) return;
      content.classList.add('content-with-keyboard');

      function updateKeyboardHeight(){
        const h = Math.round(kb.getBoundingClientRect().height);
        document.documentElement.style.setProperty('--keyboard-height', h + 'px');
      }
      window.addEventListener('load', updateKeyboardHeight);
      window.addEventListener('resize', updateKeyboardHeight);
      const mo = new MutationObserver(()=> updateKeyboardHeight());
      mo.observe(kb, { childList: true, subtree: true, attributes: true, characterData: true });
      updateKeyboardHeight();
    })();
  </script>

</body>
</html>
