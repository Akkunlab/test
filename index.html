<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <title>Prototype</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        fontFamily: {
          sans: ['"SF Pro Text"', 'ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Hiragino Kaku Gothic ProN', 'Meiryo', 'sans-serif']
        }
      }
    }
  </script>
  <style>
    :root { 
      --keyboard-height: 300px;
      --neumorphism-bg: #e6e7ee;
      --neumorphism-light: #ffffff;
      --neumorphism-dark: #d1d9e6;
      --neumorphism-shadow-light: rgba(255, 255, 255, 0.7);
      --neumorphism-shadow-dark: rgba(174, 174, 192, 0.4);
    }
    
    /* Neumorphism inset button style for all keys - stronger inset effect and circular */
    .key {
      background: var(--neumorphism-bg);
      box-shadow: 
        inset 12px 12px 24px var(--neumorphism-shadow-dark),
        inset -12px -12px 24px var(--neumorphism-shadow-light);
      border: none;
      color: #5a5a6b;
      font-weight: 500;
      transition: all 0.15s ease;
      border-radius: 50% !important;
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .key:active { 
      box-shadow: 
        inset 18px 18px 36px var(--neumorphism-shadow-dark),
        inset -18px -18px 36px var(--neumorphism-shadow-light);
      transform: scale(0.94);
    }
    
    /* Special style for tall buttons like enter */
    .key.tall-key {
      border-radius: 32px !important;
      aspect-ratio: auto;
    }
    .content-with-keyboard {
      padding-bottom: calc(var(--keyboard-height) + env(safe-area-inset-bottom));
    }
    .keyboard-fixed {
      position: fixed;
      left: 0;
      right: 0;
      bottom: env(safe-area-inset-bottom);
      background: var(--neumorphism-bg);
      max-height: 48vh;
      overflow: auto;
      box-shadow: 
        0 -8px 25px rgba(174, 174, 192, 0.3),
        0 -4px 15px rgba(255, 255, 255, 0.5);
      z-index: 60;
    }

    .keyboard-fixed .mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }

    @media (max-width:420px) {
      .keyboard-fixed .grid > button, .keyboard-fixed .grid > div { min-width: 52px; }
    }
    
    .home-indicator { 
      height: 6px; 
      width: 140px; 
      max-width: 34vw; 
      background: var(--neumorphism-bg);
      border-radius: 999px;
      box-shadow: 
        inset 6px 6px 12px var(--neumorphism-shadow-dark),
        inset -6px -6px 12px var(--neumorphism-shadow-light);
    }
    
    .bottom-icon { 
      width: 48px; 
      height: 48px;
      background: var(--neumorphism-bg);
      box-shadow: 
        inset 8px 8px 16px var(--neumorphism-shadow-dark),
        inset -8px -8px 16px var(--neumorphism-shadow-light);
      color: #5a5a6b;
      transition: all 0.15s ease;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .bottom-icon:active {
      box-shadow: 
        inset 12px 12px 24px var(--neumorphism-shadow-dark),
        inset -12px -12px 24px var(--neumorphism-shadow-light);
      transform: scale(0.9);
    }
    
    /* Content area - flat design */
    .content-area {
      background: var(--neumorphism-bg);
      border-radius: 20px;
      border: 1px solid rgba(174, 174, 192, 0.2);
    }
    
    /* Prevent mobile keyboard from appearing */
    #editor {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
      caret-color: #5a5a6b;
      color: #5a5a6b;
      background: transparent;
      white-space: pre-wrap;
      word-wrap: break-word;
      position: relative;
    }
    
    /* Pseudo cursor */
    .pseudo-cursor {
      display: inline-block;
      width: 2px;
      height: 1.2em;
      background-color: #5a5a6b;
      animation: cursor-blink 1s infinite;
      vertical-align: text-bottom;
      margin: 0 1px;
    }
    
    @keyframes cursor-blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    /* Hide mobile keyboard completely */
    input[readonly], textarea[readonly] {
      pointer-events: none;
    }
    
    @media (max-width: 768px) {
      #editor {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
    }
  </style>
</head>
<body class="min-h-screen" style="background: #e6e7ee;">

  <div class="iphone relative min-h-screen w-full overflow-auto" style="background: #e6e7ee;">

    <!-- Content area -->
    <div class="px-5">
      <div class="mt-0 h-[540px] w-full content-area">
        <div class="p-6 text-[24px] leading-8 tracking-wide">
          <div id="editor" contenteditable="true" class="min-h-[28px] outline-none break-words">„Åì„Çì„Å´„Å°„ÅØ</div>
        </div>
      </div>
    </div>

    <!-- Kana keyboard -->
    <div id="keyboard" class="keyboard-fixed pt-3 pb-4">
      <div class="mx-3 grid grid-cols-[70px_repeat(3,minmax(0,1fr))_70px] gap-3">

        <!-- left column -->
        <button class="h-16 w-16 key text-4xl">‚Üí</button>

         <!-- row 1 -->
        <button class="h-16 w-16 key text-4xl" data-kana="„ÅÇ,„ÅÑ,„ÅÜ,„Åà,„Åä">„ÅÇ</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Åã,„Åç,„Åè,„Åë,„Åì">„Åã</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Åï,„Åó,„Åô,„Åõ,„Åù">„Åï</button>
        <button data-action="backspace" class="h-16 w-16 key text-4xl">‚å´</button>

         <!-- left column row2 -->
        <button class="h-16 w-16 key text-4xl" data-action="toggle">‚Ü∫</button>

         <!-- row 2 -->
        <button class="h-16 w-16 key text-4xl" data-kana="„Åü,„Å°,„Å§,„Å¶,„Å®">„Åü</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Å™,„Å´,„Å¨,„Å≠,„ÅÆ">„Å™</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„ÅØ,„Å≤,„Åµ,„Å∏,„Åª">„ÅØ</button>
        <button class="h-16 w-16 key text-3xl leading-tight" data-action="space">Á©∫ÁôΩ</button>
         <!-- left column row3 -->
        <button class="h-16 w-16 key text-3xl" data-action="mode">ABC</button>

        <!-- row 3 -->
        <button class="h-16 w-16 key text-4xl" data-kana="„Åæ,„Åø,„ÇÄ,„ÇÅ,„ÇÇ">„Åæ</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„ÇÑ,„ÇÜ,„Çà">„ÇÑ</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Çâ,„Çä,„Çã,„Çå,„Çç">„Çâ</button>
        <button class="row-span-2 h-[140px] w-16 key tall-key text-4xl" data-action="enter">ÊîπË°å</button>

         <!-- left column row4 -->
        <button class="h-16 w-16 key text-4xl" data-action="emoji">üòä</button>

        <!-- row 4 -->
        <button class="h-16 w-16 key text-2xl" data-kana="^_^">^_^</button>
        <button class="h-16 w-16 key text-4xl" data-kana="„Çè,„Çí,„Çì">„Çè</button>
        <button class="h-16 w-16 key text-xl" data-action="punct">„ÄÅÔºüÔºÅ</button>
      </div>

      <!-- bottom controls -->
      <div class="mx-2 mt-2">
        <div class="flex items-center justify-between px-2">
          <button aria-label="language" class="rounded-full grid place-items-center text-xl bottom-icon" style="padding:6px">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15 15 0 0 1 0 20"/></svg>
          </button>

        <button aria-label="mic" class="rounded-full grid place-items-center text-xl bottom-icon" style="padding:6px">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v11"/><path d="M19 11a7 7 0 0 1-14 0"/><path d="M12 21v2"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const editor = document.getElementById('editor');
      if(!editor) return;
      editor.setAttribute('role','textbox');
      
      // Prevent mobile keyboard from appearing
      editor.setAttribute('readonly', 'readonly');
      editor.setAttribute('inputmode', 'none');
      editor.style.caretColor = 'transparent';
      
      // Remove readonly when clicking to allow contenteditable functionality
      editor.addEventListener('click', ()=> {
        editor.removeAttribute('readonly');
        editor.focus();
        // Re-add readonly immediately to prevent keyboard
        setTimeout(() => {
          editor.setAttribute('readonly', 'readonly');
          updateDisplay(); // Refresh cursor display
        }, 10);
      });
      
      // Prevent default keyboard events
      editor.addEventListener('keydown', (e) => {
        e.preventDefault();
        return false;
      });
      
      editor.addEventListener('input', (e) => {
        e.preventDefault();
        return false;
      });
      
      const keys = Array.from(document.querySelectorAll('.key'));

      // Pseudo cursor management
      let cursorPosition = 0;
      
      function updateDisplay() {
        const text = editor.textContent || '';
        const beforeCursor = text.substring(0, cursorPosition);
        const afterCursor = text.substring(cursorPosition);
        
        // Create display with pseudo cursor
        editor.innerHTML = '';
        
        if (beforeCursor) {
          const beforeSpan = document.createElement('span');
          beforeSpan.textContent = beforeCursor;
          editor.appendChild(beforeSpan);
        }
        
        // Add pseudo cursor
        const cursor = document.createElement('span');
        cursor.className = 'pseudo-cursor';
        editor.appendChild(cursor);
        
        if (afterCursor) {
          const afterSpan = document.createElement('span');
          afterSpan.textContent = afterCursor;
          editor.appendChild(afterSpan);
        }
        
        // If editor is empty, show cursor
        if (!text) {
          editor.appendChild(cursor);
        }
      }

      function placeCaretAtEnd(el){
        const text = el.textContent || '';
        cursorPosition = text.length;
        updateDisplay();
      }

      function appendText(t){
        const currentText = editor.textContent || '';
        const newText = currentText.substring(0, cursorPosition) + t + currentText.substring(cursorPosition);
        editor.textContent = newText;
        cursorPosition += t.length;
        updateDisplay();
      }

      function backspace(){
        if (cursorPosition > 0) {
          const currentText = editor.textContent || '';
          const newText = currentText.substring(0, cursorPosition - 1) + currentText.substring(cursorPosition);
          editor.textContent = newText;
          cursorPosition--;
          updateDisplay();
        }
      }

      function insertLineBreak(){
        appendText('\n');
      }

      // Pointer-based flick detection
      keys.forEach(k => {
        let start = null;
        k.style.touchAction = 'none';
        k.addEventListener('pointerdown', e => {
          k.setPointerCapture(e.pointerId);
          start = {x: e.clientX, y: e.clientY};
        });
        k.addEventListener('pointerup', e => {
          if(!start) return;
          const dx = e.clientX - start.x;
          const dy = e.clientY - start.y;
          const adx = Math.abs(dx), ady = Math.abs(dy);
          const threshold = 20; // px
          const kana = k.dataset.kana;
          const action = k.dataset.action;
          if(action){
            // handle simple actions explicitly
            switch(action){
              case 'backspace': backspace(); break;
              case 'space': appendText(' '); break;
              case 'enter': insertLineBreak(); break;
              case 'emoji': appendText('üòä'); break;
              case 'punct': appendText('„ÄÅ'); break;
              default: break;
            }
            start = null;
            return;
          }
          if(kana){
            const parts = kana.split(',').map(s=>s.trim()).filter(Boolean);
            let idx = 0; // tap
            if(Math.max(adx, ady) >= threshold){
              if(adx > ady){ // horizontal
                idx = dx > 0 ? 2 : 4;
              } else { // vertical
                idx = dy < 0 ? 1 : 3; // up : down
              }
            }
            if(idx >= parts.length){
              // fallback to nearest available
              idx = Math.min(parts.length-1, idx);
            }
            const char = parts[idx] || parts[0];
            appendText(char);
          } else {
            // if no kana and no action, treat as click
            const text = k.textContent.trim();
            if(text) appendText(text);
          }
          start = null;
        });
        k.addEventListener('pointercancel', ()=> start = null);
      });

      // Initialize pseudo cursor
      const initialText = editor.textContent || '„Åì„Çì„Å´„Å°„ÅØ';
      editor.textContent = initialText;
      cursorPosition = initialText.length;
      updateDisplay();
      
      // Ensure editor initially focused so typing works
      editor.removeAttribute('readonly');
      setTimeout(() => {
        editor.setAttribute('readonly', 'readonly');
      }, 50);
    })();
  </script>

  <script>
    // Measure keyboard and set CSS variable so page content isn't hidden
    (function(){
      const kb = document.getElementById('keyboard');
      const content = document.querySelector('.px-5');
      if(!kb || !content) return;
      // mark content area to receive bottom padding
      content.classList.add('content-with-keyboard');

      function updateKeyboardHeight(){
        // the visible height of keyboard (use getBoundingClientRect to account for safe insets)
        const h = Math.round(kb.getBoundingClientRect().height);
        document.documentElement.style.setProperty('--keyboard-height', h + 'px');
      }

      // update on load and resize
      window.addEventListener('load', updateKeyboardHeight);
      window.addEventListener('resize', updateKeyboardHeight);
      // watch for DOM changes inside keyboard (eg. dynamic panels)
      const mo = new MutationObserver(()=> updateKeyboardHeight());
      mo.observe(kb, { childList: true, subtree: true, attributes: true, characterData: true });
      // initial call
      updateKeyboardHeight();
    })();
  </script>

</body>
</html>
